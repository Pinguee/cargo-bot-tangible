<!DOCTYPE html>
<html>
<head>
  <title>Cargo Tangible</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <h1>Cargo Tangible</h1>
  </header>

  <div id="modal" class="modal">
    <div id="scanner">
      <canvas id="video-canvas" width="1280" height="720"></canvas>
      <div id="buttonContainer">
        <button id="scanButton" class="scannerButton"></button>
        <button id="closeButton" class="scannerButton"></button>
      </div>
    </div>
  </div>


  <div id="modalImg" class="modal">
    <div id="scannerImg" class="scanner">
      <canvas id="image-canvas" width="1280" height="720"></canvas>
      <div id="buttonContainerImg" class="buttonContainer">
        <button id="scanButtonImg" class="scannerButton"></button>
        <button id="closeButtonImg" class="scannerButton"></button>
      </div>
    </div>
  </div>

  <div id="modalQr" class="modal">
    <div id="qrcode" class="scanner" style="height: 800px;"></div>
    <div id="buttonContainerQr">
      <button id="closeButtonQr" class="scannerButton"></button>
    </div>
  </div>

  <div id="main">
    <div id="inputMethod">
      <button id="camInButton" class="button"></button>
      <button id="imgInButton" class="button"></button>
      <button id="phoneInButton" class="button"></button>
    </div>

    <div id="fileIn" style="display: none;">
      <input type="file" accept="image/*" id="fileInput" capture="camera">
    </div>

    <div id="selectorCam" style="display: none;">
      <select id="videoSource">
        <option value="" selected disabled hidden>Sélectionnez la caméra</option>
      </select>
    </div>

    <iframe id="frame" src="cargo-not/index.html" width="820" height="1400"></iframe>
  </div>

  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <script src="connect/peerjs.min.js"></script>
  <script src="TopCodes/js/adapter-0.2.9.js"></script>
  <script src="TopCodes/js/topcodes.js"></script>
  <script defer src="TopCodes/dart/main.dart.js"></script>
  <script src="stylescript.js"></script>
  <script src="perspective-transform.js"></script>
  <script src="test_script_rotation.js"></script>

  <script>
    // register a callback function with the TopCode library
    TopCodes.setVideoFrameCallback("video-canvas", function (jsonString) {

    // convert the JSON string to an object
    var json = JSON.parse(jsonString);

    // get the list of topcodes from the JSON object
    topcodes = json.topcodes;

    // draw a circle over the top of each TopCode
    ctx.fillStyle = "rgba(255, 0, 0)";   // very translucent red
    for (i = 0; i < topcodes.length; i++) {      
      ctx.font = '24px serif';
      ctx.fillText(topcodes[i].code.toString(), topcodes[i].x, topcodes[i].y + 50);
      // ctx.strokeRect(200, 60, 900, 600);
    };

    document.getElementById("scanButton").onclick = function(){
      scan(json.topcodes, true);  
      TopCodes.stopVideoScan('video-canvas');
      document.getElementById("modal").style.display = "none";
    }
    });

    var ctx = document.querySelector("#video-canvas").getContext('2d');
  </script>

</body>
</html>